version: 0.2

phases:
  install:
    commands:
      - echo "Installing dependencies..."
      - curl -sL https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.8.0.2856-linux.zip -o sonar-scanner.zip
      - unzip sonar-scanner.zip -d $HOME
      - export PATH=$HOME/sonar-scanner-4.8.0.2856-linux/bin:$PATH
      - sonar-scanner --version

  pre_build:
    commands:
      - echo "Setting up environment variables..."
      - export SONAR_HOST_URL=https://sonarcloud.io

  build:
    commands:
      - echo "Running SonarCloud analysis..."
      - sonar-scanner \
        -Dsonar.projectKey=PrathameshS1999_Story_Forge \
        -Dsonar.organization=prathameshs1999 \
        -Dsonar.sources=. \
        -Dsonar.python.version=3 \
        -Dsonar.host.url=$SONAR_HOST_URL \
        -Dsonar.login=$SONAR_LOGIN_TOKEN # Use an environment variable for the token

  post_build:
    commands:
      - echo "SonarCloud analysis complete."

artifacts:
  files:
    - buildspec.yml
    - sonar-report.json # Ensure this file is generated by Sonar Scanner
