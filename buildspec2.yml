version: 0.2

phases:
  install:
    commands:
      - echo "Installing required packages"
      - pip install --upgrade pip
      - pip install pylint
      - curl -sL https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.8.0.2856-linux.zip -o sonar-scanner.zip
      - unzip sonar-scanner.zip -d $HOME
      - export PATH=$HOME/sonar-scanner-4.8.0.2856-linux/bin:$PATH
      - echo "SonarScanner installed"
      
  pre_build:
    commands:
      - echo "Setting up environment"
      - export SONAR_HOST_URL=https://sonarcloud.io
      - echo "Environment setup complete"

  build:
    commands:
      - echo "Running static analysis with PyLint"
      - pylint **/*.py || true
      - echo "Running SonarCloud analysis"
      - |
        sonar-scanner \
        -Dsonar.projectKey=<prathameshs1999> \
        -Dsonar.sources=. \
        -Dsonar.python.version=3 \
        -Dsonar.host.url=$SONAR_HOST_URL \
        -Dsonar.login=<your_sonarcloud_token>

  post_build:
    commands:
      - echo "Static code analysis completed"

artifacts:
  files:
    - sonar-report.json
    - pylint.log
  discard-paths: yes

cache:
  paths:
    - $HOME/.sonar/cache
